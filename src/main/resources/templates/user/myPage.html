<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko" th:with="currentTab='home'">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- ë°˜ì‘í˜• í•„ìˆ˜ -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>í™ˆ</title>

    <!-- page-specific styles only (ë‚´ë¹„ ê´€ë ¨ì€ í¬í•¨í•˜ì§€ ì•ŠìŒ) -->
    <style>
        /* page-specific styles only */
        main.container { padding: 24px 0; }
    </style>

    <style>
        :root { --primary:#5a7dff; --muted:#e9e9ee; --text:#222; }
        body{font-family:system-ui,AppleSDGothicNeo,Segoe UI,Roboto,Arial,sans-serif; color:var(--text); margin:0;}
        .container{max-width: 1080px; margin: 40px auto; padding: 0 16px;}
        h1{font-size: 28px; margin: 8px 0 24px; text-align:center;}
        h2{font-size: 22px; margin: 40px 0 16px;}
        .card{background:#fff; border:1px solid #f0f0f2; border-radius:14px; padding:24px; box-shadow:0 2px 10px rgba(0,0,0,.03);}
        .pill{display:inline-flex; border-radius:999px; padding:6px; gap:6px;}
        .pill button{border:0; background:transparent; padding:10px 18px; border-radius:999px; cursor:pointer; color:#777; font-weight:600;}
        .pill button.active{background:var(--primary); color:#fff;}
        .center{display:flex; flex-direction:column; align-items:center; gap:8px; color:#666; margin: 28px 0;}
        .grid{display:grid; grid-template-columns:1fr 1fr; gap:16px;}
        .form-label{font-weight:700; display:block; margin-bottom:6px;}
        .form-control,.form-select{width:100%; border:1px solid #e6e6ea; border-radius:10px; padding:12px 14px; background:#f7f8fb;}
        .btn{display:inline-block; padding:10px 16px; border-radius:10px; border:1px solid #d9d9df; background:#f6f6fa; cursor:pointer;}
        .btn-primary{background:var(--primary); border-color:var(--primary); color:#fff;}
        .row-actions{display:flex; gap:8px; align-items:center;}
        .muted{color:#888; font-size:12px;}
        .hidden{display:none;}

        @media (max-width: 768px){ .grid{grid-template-columns:1fr;} }
    </style>

    <!--ì¶”ê°€ ìŠ¤íƒ€ì¼-->
    <style>
        /* horizontal scroller */
        .h-scroll{position:relative;margin-top:16px}
        .h-track{
            display:grid; grid-auto-flow:column; grid-auto-columns: 82%;
            gap:14px; overflow-x:auto; overscroll-behavior-x:contain;
            scroll-snap-type:x mandatory; padding:6px 4px 14px;
            scrollbar-width:none;
        }
        .h-track::-webkit-scrollbar{display:none}
        .card-snap{scroll-snap-align:start}
        @media (min-width:900px){ .h-track{grid-auto-columns: 46%} }
        @media (min-width:1200px){ .h-track{grid-auto-columns: 32%} }

        /* card visuals (ì¬ì‚¬ìš©) */
        .cardX{background:#fff;border:1px solid #f0f0f2;border-radius:14px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.03)}
        .cardX .media{position:relative;aspect-ratio:16/9;background:#f7f8fb}
        .cardX .media img{width:100%;height:100%;object-fit:cover;display:block}
        .badgeX{position:absolute;top:10px;left:10px;padding:6px 10px;border-radius:999px;font-size:12px;color:#fff;background:#9aa1ff}
        .badgeX.green{background:#22c55e}
        .badgeX.gray{background:#9ca3af}
        .cardX .body{padding:12px 14px 14px}
        .cardX .title{font-weight:800;margin:2px 0 6px}
        .cardX .meta{display:flex;gap:10px;flex-wrap:wrap;color:#777;font-size:12px;margin-bottom:6px}
        .cardX .desc{font-size:14px;color:#333;margin:6px 0 10px;line-height:1.45;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .cardX .row{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:#555}
        .cardX .actions{display:flex;gap:8px;margin-top:10px}
        .btn-mini{padding:8px 12px;border-radius:10px;border:1px solid #d9d9df;background:#f6f6fa;cursor:pointer}
        .btn-mini.primary{background:var(--primary);border-color:var(--primary);color:#fff}

        /* scroller arrows */
        .h-arrows{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
        .h-arrows .nav{border:0;background:#f2f3f6;border-radius:10px;padding:8px 10px;cursor:pointer}


        /* í¼ ë ˆì´ì•„ì›ƒ ê°œì„  */
        .form-grid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:16px 20px;}
        .form-item{min-width:0; display:flex; flex-direction:column; gap:8px;}
        .form-item.span-2{grid-column:1 / -1;}
        .input,.select{width:100%; min-height:44px; border:1px solid #e6e6ea; border-radius:10px; background:#f7f8fb; padding:10px 14px;}
        .input:focus,.select:focus{outline:none; border-color:#5a7dff; box-shadow:0 0 0 4px rgba(90,125,255,.15);}
        .actions-row{display:flex; gap:8px; justify-content:flex-end; margin-top:20px;}
        @media (max-width:768px){ .form-grid{grid-template-columns:1fr;} }
    </style>
    <style>
        /* ì¶”ì²œ: ëª¨ë“  ìš”ì†Œ ë°•ìŠ¤ê³„ì‚° ì•ˆì •í™” */
        *, *::before, *::after { box-sizing: border-box; }

        /* í¼ ì „ìš© ë ˆì´ì•„ì›ƒ */
        .form-grid{
            display:grid;
            grid-template-columns:repeat(2, minmax(0, 1fr)); /* â† ì¤„ì–´ë“¤ ìˆ˜ ìˆê²Œ */
            gap:16px 20px;
            align-items:start;
        }
        .form-grid > *{ min-width:0; }                    /* â† ì…€ ë‚´ë¶€ê°€ ì¹¸ì„ ëª» ë°€ê²Œ */
        .form-control, .form-select{ min-width:0; }       /* â† ì¸í’‹/ì…€ë ‰íŠ¸ë„ ë™ì¼ */

        @media (max-width:768px){
            .form-grid{ grid-template-columns:1fr; }
        }
    </style>


</head>
<body>
<link rel="stylesheet" th:href="@{/nav.css}" />
<link rel="stylesheet" th:href="@{/home/home.css}" />
<!-- ìƒë‹¨ ê³µí†µ ë„¤ë¹„ (nav.css ìŠ¤íƒ€ì¼ ì‚¬ìš©) -->
<header class="site-header">
    <div class="inner">
        <!-- ì¢Œ: ë¸Œëœë“œ -->
        <a class="brand" href="/user">ì¶˜ì²œì§€ì¼œë´„</a>

        <!-- ê°€ìš´ë°: ë©”ë‰´ -->
        <nav class="nav-links">
            <a class="nav-link" href="/trash/reportPage"
               th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.matches('.*/trash/reportPage.*')} ? ' active' : ''">
                ì§€ë„
            </a>
            <a class="nav-link" href="/personal/missionPage"
               th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.matches('.*/personal/.*')} ? ' active' : ''">
                ì°¸ì—¬
            </a>
            <a class="nav-link" href="/center"
               th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.matches('.*/center.*')} ? ' active' : ''">
                ì„¼í„°
            </a>
            <a class="nav-link" href="/info"
               th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.matches('.*/info.*')} ? ' active' : ''">
                ì •ë³´
            </a>
        </nav>

        <!-- ìš°: ë¡œê·¸ì¸/ì‚¬ìš©ì -->
        <div class="auth">
            <!-- ë¡œê·¸ì¸ ì „ -->
            <a class="btn" th:if="${#strings.isEmpty(session.user_id)}" th:href="@{/user/login}">ë¡œê·¸ì¸</a>

            <!-- ë¡œê·¸ì¸ í›„ -->
            <div th:unless="${#strings.isEmpty(session.user_id)}" style="display:flex; gap:8px;">
                <a class="btn" th:href="@{/user/myPage}">ë‚´ ì •ë³´</a>
                <a class="btn primary" th:href="@{/user/logOut}">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
    </div>
</header>

<!-- (ì˜µì…˜) ëª¨ë°”ì¼ í•˜ë‹¨ ë„¤ë¹„ -->
<nav class="bottom-nav" aria-label="í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜">
    <div class="bn-inner">
        <a class="bn-item" href="/trash/reportPage">
            <span class="ic">ğŸ“</span><span>ì§€ë„</span>
        </a>
        <a class="bn-item" href="/personal/missionPage">
            <span class="ic">ğŸ¯</span><span>ì°¸ì—¬</span>
        </a>
        <a class="bn-item" href="/center">
            <span class="ic">ğŸ›ï¸</span><span>ì„¼í„°</span>
        </a>
        <a class="bn-item" href="/info">
            <span class="ic">â„¹ï¸</span><span>ì •ë³´</span>
        </a>
        <a class="bn-item" th:href="${#strings.isEmpty(session.user_id)} ? @{/user/login} : @{/user/myPage}">
            <span class="ic">ğŸ‘¤</span>
            <span th:text="${#strings.isEmpty(session.user_id)} ? 'ë¡œê·¸ì¸' : 'ë‚´ ì •ë³´'">ë‚´ ì •ë³´</span>
        </a>
    </div>
</nav>



<!---->

<div class="container">

    <!-- ë‚´ ì‹ ê³ í•´ê²° -->
    <h1>ë‚´ ì‹ ê³ í•´ê²°</h1>
    <div class="card" id="reportSection">
        <div class="pill" role="tablist" aria-label="ì‹ ê³ /í•´ê²° ì „í™˜">
            <button id="tab-report" class="active" aria-selected="true">ì‹ ê³ </button>
            <button id="tab-resolved" aria-selected="false">í•´ê²°</button>
        </div>

        <!-- ì‹ ê³  íƒ­ ì»¨í…ì¸  -->
        <div id="pane-report" class="pane">
            <!-- ë¹ˆ ìƒíƒœ -->
            <div class="center" th:if="${#lists.isEmpty(rList)}">
                <img th:src="@{/img/empty-note.png}" alt="" width="120" height="120" onerror="this.style.display='none'">
                <div>ì‹ ê³  ë‚´ì—­ì´ ì—†ì–´ìš”</div>
            </div>

            <!-- ë¦¬ìŠ¤íŠ¸ -->
            <div class="h-scroll" th:if="${!#lists.isEmpty(rList)}">
                <div class="h-track" id="trackReport">
                    <article class="cardX card-snap" th:each="r : ${rList}">
                        <div class="media">
                            <img th:src="${r.image_url}" alt="">
                            <span class="badgeX"
                                  th:text="${r.status} ? 'í•´ê²°ì™„ë£Œ' : 'ì‹ ê³ ì ‘ìˆ˜'"
                                  th:classappend="${r.status} ? ' green' : ''"></span>
                        </div>
                        <div class="body">
                            <div class="title" th:text="${r.title}">ì œëª©</div>
                            <div class="meta">
<!--                                <span th:text="${r.addr}">ì£¼ì†Œ</span>-->
                                <span th:text="${#temporals.format(r.created_at,'yyyy.MM.dd HH:mm')}">ë‚ ì§œ</span>
                            </div>
                            <p class="desc" th:text="${r.description}">ì„¤ëª…</p>
                            <div class="row">
                                <span>í¬ì¸íŠ¸ <b th:text="${r.point}">0</b></span>
                                <span>#<b th:text="${r.report_id}">-</b></span>
                            </div>
                        </div>
                    </article>
                </div>
                <div class="h-arrows">
                    <button class="nav" data-target="#trackReport" data-dir="-1">â—€</button>
                    <button class="nav" data-target="#trackReport" data-dir="1">â–¶</button>
                </div>
            </div>
        </div>

        <!-- í•´ê²° íƒ­ ì»¨í…ì¸  -->
        <div id="pane-resolved" class="pane hidden">
            <!-- ë¹ˆ ìƒíƒœ -->
            <div class="center" th:if="${#lists.isEmpty(sList)}">
                <img th:src="@{/img/empty-note.png}" alt="" width="120" height="120" onerror="this.style.display='none'">
                <div>í•´ê²°ëœ ë‚´ì—­ì´ ì—†ì–´ìš”</div>
            </div>

            <!-- ë¦¬ìŠ¤íŠ¸ -->
            <div class="h-scroll" th:if="${!#lists.isEmpty(sList)}">
                <div class="h-track" id="trackSolved">
                    <article class="cardX card-snap" th:each="s : ${sList}">
                        <div class="media">
                            <img th:src="${s.proof_image_url != null ? s.proof_image_url : s.image_url}" alt="">
                            <span class="badgeX green">í•´ê²°ì™„ë£Œ</span>
                        </div>
                        <div class="body">
                            <div class="title" th:text="${s.title}">ì œëª©</div>
                            <div class="meta">
<!--                                <span th:text="${s.addr}">ì£¼ì†Œ</span>-->
                                <span th:text="${#temporals.format(s.solved_at,'yyyy.MM.dd HH:mm')}">í•´ê²°ì¼</span>
                            </div>
                            <p class="desc" th:text="${s.note != null ? s.note : 'ë©”ëª¨ ì—†ìŒ'}">ë©”ëª¨</p>
                            <div class="row">
                                <span>í•´ê²°ì <b th:text="${s.resolver_id}">ë‚˜</b></span>
                                <span>#<b th:text="${s.report_id}">-</b></span>
                            </div>
                        </div>
                    </article>
                </div>
                <div class="h-arrows">
                    <button class="nav" data-target="#trackSolved" data-dir="-1">â—€</button>
                    <button class="nav" data-target="#trackSolved" data-dir="1">â–¶</button>
                </div>
            </div>
        </div>
    </div>

    <h2>ì •ë³´ìˆ˜ì •</h2>
    <div class="card">
        <form id="mypageForm" onsubmit="return false;">
            <div class="form-grid">

                <!-- 1í–‰ -->
                <div class="form-item">
                    <label class="form-label" for="user_nick_name">ë‹‰ë„¤ì„</label>
                    <input id="user_nick_name" name="user_nick_name" class="input" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" th:value="${uDTO.user_nick_name}">
                </div>
                <div class="form-item">
                    <label class="form-label" for="residence_dong">ê±°ì£¼ í–‰ì •ë™</label>
                    <input id="residence_dong" name="residence_dong" class="input" placeholder="ì˜ˆ: ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™" th:value="${uDTO.residence_dong}">
                </div>
                <div class="form-item">
                    <label class="form-label" for="workplace_or_school_dong">ì§ì¥/í•™êµ í–‰ì •ë™</label>
                    <input id="workplace_or_school_dong" name="workplace_or_school_dong" class="input" placeholder="ì˜ˆ: ì„œìš¸ ì„œì´ˆêµ¬ ì„œì´ˆë™" th:value="${uDTO.workplace_or_school_dong}">
                </div>

                <!-- 3í–‰ -->
                <div class="form-item">
                    <label class="form-label" for="commute_by_car">ìê°€ìš© ì¶œí‡´ê·¼</label>
                    <select id="commute_by_car" name="commute_by_car" class="select">
                        <option value="true">ì˜ˆ</option>
                        <option value="false">ì•„ë‹ˆì˜¤</option>
                    </select>
                </div>
                <div class="form-item">
                    <label class="form-label" for="cafe_use_freq">ì¹´í˜ ì´ìš© ë¹ˆë„</label>
                    <select id="cafe_use_freq" name="cafe_use_freq" class="select">
                        <option>ì£¼ 1íšŒ</option><option>ì£¼ 3íšŒ</option><option>ë§¤ì¼</option>
                    </select>
                </div>

                <!-- 4í–‰ -->
                <div class="form-item">
                    <label class="form-label" for="grocery_freq">ì¥ë³´ê¸° ë¹ˆë„</label>
                    <select id="grocery_freq" name="grocery_freq" class="select">
                        <option>ì£¼ 1íšŒ</option><option>ì£¼ 2íšŒ</option><option>í•„ìš”ì‹œ</option>
                    </select>
                </div>
                <div class="form-item">
                    <label class="form-label" for="practice_energy_saving">ì—ë„ˆì§€ ì ˆì•½ ì‹¤ì²œ</label>
                    <select id="practice_energy_saving" name="practice_energy_saving" class="select">
                        <option value="true">ì˜ˆ</option><option value="false">ì•„ë‹ˆì˜¤</option>
                    </select>
                </div>

                <!-- í•„ìš” ì‹œ ì „ì²´í­ í•„ë“œ -->
                <!-- <div class="form-item span-2"> ... </div> -->

            </div>

            <div class="actions-row">
                <button type="button" class="btn" id="btnCancel">ì·¨ì†Œ</button>
                <button type="button" class="btn btn-primary" id="btnSave">ì €ì¥</button>
            </div>
        </form>
    </div>
</div>

<!-- (ì„ íƒ) jQuery
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
-->

<script>
    // --- ì‹ ê³ /í•´ê²° íƒ­ ì „í™˜ ---
    const tabReport   = document.getElementById('tab-report');
    const tabResolved = document.getElementById('tab-resolved');
    const paneReport  = document.getElementById('pane-report');
    const paneResolved= document.getElementById('pane-resolved');

    function activate(tab){
        if(tab==='report'){
            tabReport.classList.add('active'); tabReport.setAttribute('aria-selected','true');
            tabResolved.classList.remove('active'); tabResolved.setAttribute('aria-selected','false');
            paneReport.classList.remove('hidden'); paneResolved.classList.add('hidden');
        }else{
            tabResolved.classList.add('active'); tabResolved.setAttribute('aria-selected','true');
            tabReport.classList.remove('active'); tabReport.setAttribute('aria-selected','false');
            paneResolved.classList.remove('hidden'); paneReport.classList.add('hidden');
        }
    }
    tabReport.addEventListener('click', ()=>activate('report'));
    tabResolved.addEventListener('click', ()=>activate('resolved'));

    // --- ì •ë³´ ì €ì¥(ì˜ˆì‹œ: Ajax ì—°ë™ ì§€ì ) ---
    document.getElementById('btnSave').addEventListener('click', function(){
        // TODO: ê°’ ìˆ˜ì§‘ í›„ Ajaxë¡œ /mypage/update ê°™ì€ ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
        // ì˜ˆ) const payload = { user_nick_name: document.getElementById('user_nick_name').value, ... };
        alert('ì €ì¥ ë¡œì§ì„ ì—°ê²°í•˜ì„¸ìš”.');
    });

    document.getElementById('btnCancel').addEventListener('click', function(){
        history.back(); // í•„ìš” ì‹œ ë³€ê²½
    });
</script>
<!--ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸-->
<script>
    // ì¢Œìš° ë²„íŠ¼ ìŠ¤í¬ë¡¤
    document.querySelectorAll('.h-arrows .nav').forEach(btn=>{
        btn.addEventListener('click', ()=>{
            const track = document.querySelector(btn.dataset.target);
            const dir = Number(btn.dataset.dir);
            const delta = Math.round(track.clientWidth * 0.9) * dir; // 90% í­ì”©
            track.scrollBy({left: delta, behavior: 'smooth'});
        });
    });

    // (ì„ íƒ) ë“œë˜ê·¸ë¡œ ìŠ¤í¬ë¡¤
    ['trackReport','trackSolved'].forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        let isDown=false,startX,scrollLeft;
        el.addEventListener('pointerdown',e=>{isDown=true;startX=e.pageX;scrollLeft=el.scrollLeft;el.setPointerCapture(e.pointerId);});
        el.addEventListener('pointermove',e=>{if(!isDown) return; el.scrollLeft = scrollLeft - (e.pageX-startX);});
        ['pointerup','pointerleave'].forEach(ev=>el.addEventListener(ev,()=>{isDown=false;}));
    });

    // í•´ê²° ëª¨ë‹¬ (ì˜ˆì‹œ)
    function openSolveModal(button){
        const id = button.getAttribute('data-id');
        // TODO: ëª¨ë‹¬ ì—´ê¸° ë¡œì§ ì—°ê²°
        console.log('solve report', id);
    }
</script>
</body>
</html>
